name: ğŸš€ Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: ğŸ” Checkout repository
        uses: actions/checkout@v4

      # 2. å®‰è£… pnpmï¼ˆå¿…é¡»åœ¨ setup-node ä¹‹å‰ï¼‰
      - name: ğŸ“¦ Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
          run_install: false  # ä¸è‡ªåŠ¨å®‰è£…ä¾èµ–ï¼ˆåç»­æ‰‹åŠ¨å®‰è£…ï¼‰

      # 3. å°† pnpm æ·»åŠ åˆ° PATHï¼ˆå…³é”®ä¿®å¤ï¼‰
      - name: ğŸ“¦ Add pnpm to PATH
        run: |
          echo "$(pnpm bin):$PATH" >> $GITHUB_PATH
          pnpm --version  # éªŒè¯å®‰è£…

      # 4. å®‰è£… Node.jsï¼ˆå¯ç”¨ pnpm ç¼“å­˜ï¼‰
      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'

      # 5. å®‰è£…ä¾èµ–
      - name: ğŸ“¦ Install dependencies
        run: pnpm install

      # 6. æ„å»ºé¡¹ç›®
      - name: ğŸ”§ Build project
        run: pnpm run build

      # 7. å¤„ç†å®¢æˆ·ç«¯è·¯ç”±ï¼ˆé€‚ç”¨äº SPAï¼‰
      - name: ğŸ§± Copy index.html to 404.html
        run: cp dist/index.html dist/404.html

      # 8. éƒ¨ç½²åˆ° GitHub Pages
      - name: ğŸš€ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}  # æˆ–ä½¿ç”¨ secrets.GH_PAT
          publish_dir: ./dist